<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KisanMitra ‚Äî Smart Farming Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --soil:#2D1B0E; --earth:#5C3D1E; --harvest:#E8B84B;
  --leaf:#3D7A3D; --leaf-light:#5BA55B; --cream:#FDF6E3;
  --rust:#C0392B; --success:#27AE60; --warn:#E67E22;
  --text:#1A0F0A; --muted:#7A6655; --nav-h:64px;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{background:var(--cream);font-family:'Source Sans 3',sans-serif;color:var(--text)}

/* ‚ïê‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê‚ïê */
.navbar{
  position:fixed;top:0;left:0;right:0;z-index:200;height:var(--nav-h);
  background:var(--soil);display:flex;align-items:center;padding:0 32px;
  box-shadow:0 2px 20px rgba(0,0,0,0.3);
}
.nav-brand{display:flex;align-items:center;gap:10px;text-decoration:none;margin-right:auto;cursor:pointer}
.nav-logo{width:40px;height:40px;background:var(--harvest);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 2px 10px rgba(228,184,75,0.4)}
.nav-brand-name{font-family:'Playfair Display',serif;font-size:22px;color:var(--harvest);font-weight:900}
.nav-brand-sub{font-size:10px;color:rgba(255,255,255,0.45);letter-spacing:1.5px;text-transform:uppercase;line-height:1}
.nav-links{display:flex;align-items:center;gap:2px}
.nav-link{
  padding:8px 14px;border-radius:8px;border:none;background:transparent;
  color:rgba(255,255,255,0.7);font-size:13px;font-weight:600;cursor:pointer;
  transition:all .2s;font-family:'Source Sans 3',sans-serif;
}
.nav-link:hover,.nav-link.active{background:rgba(228,184,75,0.15);color:var(--harvest)}
.nav-cta{
  margin-left:12px;padding:8px 18px;background:var(--harvest);color:var(--soil);
  border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;
  transition:all .2s;font-family:'Source Sans 3',sans-serif;
}
.nav-cta:hover{background:#F5D76E;transform:translateY(-1px)}
.nav-lang{display:flex;gap:5px;margin-left:14px}
.lang-btn{
  padding:5px 11px;border-radius:16px;border:1px solid rgba(255,255,255,0.2);
  background:transparent;color:rgba(255,255,255,0.6);cursor:pointer;font-size:12px;
  transition:all .2s;font-family:'Source Sans 3',sans-serif;
}
.lang-btn.active{background:var(--harvest);color:var(--soil);border-color:var(--harvest);font-weight:700}

/* ‚ïê‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê */
.hero-band{
  background:linear-gradient(135deg,var(--leaf) 0%,#1E4A1E 100%);
  padding:calc(var(--nav-h) + 48px) 40px 72px;
  position:relative;overflow:hidden;
}
.hero-band::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:50px;background:var(--cream);clip-path:ellipse(55% 100% at 50% 100%)}
.hero-band::before{
  content:'';position:absolute;inset:0;pointer-events:none;
  background:url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.025'%3E%3Cpath d='M40 10 Q50 25 40 40 Q30 25 40 10Z'/%3E%3C/g%3E%3C/svg%3E") repeat;
}
.hero-inner{max-width:1180px;margin:0 auto;display:grid;grid-template-columns:1.1fr 0.9fr;gap:48px;align-items:center;position:relative;z-index:1}
.hero-h1{font-family:'Playfair Display',serif;font-size:50px;color:#fff;line-height:1.15;margin-bottom:16px}
.hero-h1 span{color:var(--harvest)}
.hero-p{color:rgba(255,255,255,0.82);font-size:16px;line-height:1.75;margin-bottom:28px}
.hero-btns{display:flex;gap:12px;flex-wrap:wrap}
.btn-primary{padding:13px 26px;background:var(--harvest);color:var(--soil);border:none;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;font-family:'Source Sans 3',sans-serif}
.btn-primary:hover{background:#F5D76E;transform:translateY(-2px);box-shadow:0 6px 20px rgba(228,184,75,0.4)}
.btn-outline{padding:13px 26px;background:transparent;color:#fff;border:2px solid rgba(255,255,255,0.4);border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Source Sans 3',sans-serif}
.btn-outline:hover{border-color:#fff;background:rgba(255,255,255,0.08)}
.hero-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:30px}
.stat-box{background:rgba(255,255,255,0.09);border:1px solid rgba(255,255,255,0.13);border-radius:12px;padding:14px;text-align:center}
.stat-num{font-family:'Playfair Display',serif;font-size:26px;font-weight:900;color:var(--harvest)}
.stat-lbl{font-size:11px;color:rgba(255,255,255,0.6);margin-top:2px}
.hero-pills{display:flex;gap:8px;flex-wrap:wrap;margin-top:18px}
.hero-pill{background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.18);border-radius:30px;padding:6px 13px;color:#fff;font-size:12px;font-weight:600}
.feature-cards{display:flex;flex-direction:column;gap:12px}
.feat-card{background:rgba(255,255,255,0.09);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.15);border-radius:14px;padding:16px;display:flex;align-items:flex-start;gap:13px}
.feat-icon{font-size:24px;flex-shrink:0}
.feat-card h4{font-size:14px;font-weight:700;color:#fff;margin-bottom:3px}
.feat-card p{font-size:12px;color:rgba(255,255,255,0.65);line-height:1.45}

/* ‚ïê‚ïê‚ïê‚ïê SECTION WRAPPER ‚ïê‚ïê‚ïê‚ïê */
.sec-wrap{max-width:1180px;margin:0 auto;padding:70px 24px}
.sec-title{font-family:'Playfair Display',serif;font-size:32px;color:var(--soil);margin-bottom:6px}
.sec-sub{color:var(--muted);font-size:14px;margin-bottom:32px}

/* ‚ïê‚ïê‚ïê‚ïê ANALYZER ‚ïê‚ïê‚ïê‚ïê */
#analyzer{scroll-margin-top:var(--nav-h)}
.input-card{background:#fff;border-radius:20px;padding:30px;box-shadow:0 2px 24px rgba(45,27,14,0.08);border:1px solid rgba(45,27,14,0.06);margin-bottom:28px}
.card-title{font-family:'Playfair Display',serif;font-size:19px;color:var(--soil);margin-bottom:3px;display:flex;align-items:center;gap:9px}
.card-sub{color:var(--muted);font-size:13px;margin-bottom:20px}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(185px,1fr));gap:16px;margin-bottom:20px}
.form-group label{display:block;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--earth);margin-bottom:5px}
.form-group select,.form-group input{width:100%;padding:10px 13px;border:2px solid rgba(45,27,14,0.1);border-radius:10px;font-family:'Source Sans 3',sans-serif;font-size:14px;color:var(--text);background:var(--cream);outline:none;transition:border-color .2s;cursor:pointer}
.form-group select:focus,.form-group input:focus{border-color:var(--leaf)}
.analyze-btn{width:100%;padding:15px;background:linear-gradient(135deg,var(--leaf),#1E4A1E);color:#fff;border:none;border-radius:12px;font-family:'Source Sans 3',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s}
.analyze-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(61,122,61,0.4)}

/* results */
.results-section{display:none}
.results-section.visible{display:block;animation:fadeUp .5s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.kpi-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-bottom:18px}
.kpi-card{background:#fff;border-radius:16px;padding:22px;text-align:center;box-shadow:0 2px 14px rgba(45,27,14,0.06);border:1px solid rgba(45,27,14,0.06);position:relative;overflow:hidden}
.kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;border-radius:16px 16px 0 0}
.kpi-card.g::before{background:linear-gradient(90deg,var(--leaf),var(--leaf-light))}
.kpi-card.o::before{background:linear-gradient(90deg,var(--warn),#F39C12)}
.kpi-card.b::before{background:linear-gradient(90deg,#2980B9,#3498DB)}
.kpi-lbl{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:7px}
.kpi-val{font-family:'Playfair Display',serif;font-size:30px;font-weight:900;line-height:1;margin-bottom:4px}
.kpi-card.g .kpi-val{color:var(--leaf)}.kpi-card.o .kpi-val{color:var(--warn)}.kpi-card.b .kpi-val{color:#2980B9}
.kpi-desc{font-size:12px;color:var(--muted)}
.mod-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
.mod-card{background:#fff;border-radius:16px;padding:24px;box-shadow:0 2px 14px rgba(45,27,14,0.06);border:1px solid rgba(45,27,14,0.06)}
.mod-hdr{display:flex;align-items:center;gap:11px;margin-bottom:13px}
.mod-icon{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.mod-icon.g{background:rgba(61,122,61,0.1)}.mod-icon.o{background:rgba(230,126,34,0.1)}.mod-icon.b{background:rgba(41,128,185,0.1)}.mod-icon.r{background:rgba(192,57,43,0.1)}
.mod-hdr-t h3{font-family:'Playfair Display',serif;font-size:16px;color:var(--soil)}
.mod-hdr-t p{font-size:11px;color:var(--muted)}
.timeline-track{height:7px;background:rgba(45,27,14,0.08);border-radius:4px;position:relative;margin-bottom:5px}
.timeline-fill{position:absolute;top:0;height:100%;border-radius:4px;background:linear-gradient(90deg,var(--leaf-light),var(--harvest))}
.timeline-marker{position:absolute;top:50%;transform:translateY(-50%);width:13px;height:13px;background:var(--harvest);border:3px solid #fff;border-radius:50%;box-shadow:0 2px 8px rgba(228,184,75,0.5)}
.tl-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--muted)}
.harvest-rec{background:linear-gradient(135deg,rgba(61,122,61,0.06),rgba(61,122,61,0.02));border:1.5px solid rgba(61,122,61,0.2);border-radius:11px;padding:13px;margin-top:11px}
.rec-main{font-size:17px;font-weight:700;color:var(--leaf);margin-bottom:3px}
.rec-sub{font-size:12px;color:var(--muted);line-height:1.5}
.flist{display:flex;flex-direction:column;gap:6px;margin-top:9px}
.fi{display:flex;align-items:center;gap:9px;padding:6px 10px;border-radius:7px;background:rgba(45,27,14,0.03);font-size:12px}
.fi.good{border-left:3px solid var(--success)}.fi.warn{border-left:3px solid var(--warn)}.fi.bad{border-left:3px solid var(--rust)}
.fdot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.fi.good .fdot{background:var(--success)}.fi.warn .fdot{background:var(--warn)}.fi.bad .fdot{background:var(--rust)}
.mkt-tbl{width:100%;border-collapse:collapse;font-size:12px;margin-top:7px}
.mkt-tbl th{text-align:left;padding:6px 8px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);border-bottom:2px solid rgba(45,27,14,0.08)}
.mkt-tbl td{padding:8px 8px;border-bottom:1px solid rgba(45,27,14,0.05);vertical-align:middle}
.mkt-tbl tr.br{background:rgba(61,122,61,0.05)}
.best-badge{background:var(--leaf);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:8px;text-transform:uppercase;margin-left:4px}
.pbar-wrap{display:flex;align-items:center;gap:5px}
.pbar{height:5px;border-radius:3px;background:var(--leaf)}
.gauge-wrap{display:flex;align-items:center;gap:16px;margin:10px 0 13px}
.gauge-c{width:84px;height:84px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;flex-direction:column;position:relative}
.gauge-c svg{position:absolute;inset:0;transform:rotate(-90deg)}
.gauge-n{font-family:'Playfair Display',serif;font-size:22px;font-weight:900;position:relative;z-index:1;line-height:1}
.gauge-p{font-size:10px;color:var(--muted);position:relative;z-index:1}
.gauge-t h4{font-size:14px;font-weight:700;margin-bottom:3px}
.gauge-t p{font-size:12px;color:var(--muted);line-height:1.4}
.act-list{display:flex;flex-direction:column;gap:7px}
.act-item{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:9px;border:1px solid rgba(45,27,14,0.08);background:rgba(253,246,227,0.5);transition:all .2s}
.act-item:hover{background:rgba(61,122,61,0.05);border-color:rgba(61,122,61,0.2)}
.act-rank{width:25px;height:25px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
.act-rank.r1{background:rgba(39,174,96,0.15);color:var(--success)}.act-rank.r2{background:rgba(52,152,219,0.15);color:#2980B9}.act-rank.r3{background:rgba(230,126,34,0.15);color:var(--warn)}
.act-body{flex:1}
.act-name{font-size:13px;font-weight:600;color:var(--soil)}
.act-detail{font-size:11px;color:var(--muted)}
.act-cost{font-size:11px;font-weight:700;color:var(--earth);white-space:nowrap}
.dots{display:flex;gap:3px}
.dot{width:7px;height:7px;border-radius:50%;background:rgba(45,27,14,0.15)}
.dot.f{background:var(--leaf)}
.why-card{background:var(--soil);border-radius:20px;padding:28px;margin-top:16px;position:relative;overflow:hidden}
.why-card::before{content:'"';position:absolute;top:-20px;right:28px;font-family:'Playfair Display',serif;font-size:180px;color:rgba(255,255,255,0.03);pointer-events:none;line-height:1}
.reason-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(195px,1fr));gap:13px;margin-top:16px}
.reason-step{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:13px;padding:17px}
.rs-num{font-family:'Playfair Display',serif;font-size:30px;font-weight:900;color:rgba(228,184,75,0.3);line-height:1;margin-bottom:6px}
.rs-title{font-size:13px;font-weight:700;color:var(--harvest);margin-bottom:4px}
.rs-desc{font-size:12px;color:rgba(255,255,255,0.65);line-height:1.5}
.conf-banner{background:rgba(228,184,75,0.1);border:1px solid rgba(228,184,75,0.25);border-radius:11px;padding:12px 15px;display:flex;align-items:center;gap:12px;margin-top:14px}
.conf-t h4{font-size:12px;font-weight:700;color:var(--harvest);margin-bottom:2px}
.conf-t p{font-size:11px;color:rgba(255,255,255,0.55);line-height:1.4}
.conf-bar-o{width:85px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;margin-bottom:3px}
.conf-bar-i{height:100%;background:linear-gradient(90deg,var(--harvest),#F5D76E);border-radius:3px}
.conf-pct{font-size:11px;font-weight:700;color:var(--harvest)}

/* ‚ïê‚ïê‚ïê‚ïê ABOUT ‚ïê‚ïê‚ïê‚ïê */
#about{background:#fff;scroll-margin-top:var(--nav-h)}
.about-grid{display:grid;grid-template-columns:1fr 1fr;gap:56px;align-items:start;margin-top:36px}
.about-txt h3{font-family:'Playfair Display',serif;font-size:24px;color:var(--soil);margin-bottom:12px}
.about-txt p{color:var(--muted);line-height:1.8;margin-bottom:12px;font-size:14px}
.about-cards{display:grid;grid-template-columns:1fr 1fr;gap:13px}
.ab-card{background:var(--cream);border-radius:13px;padding:18px;border:1px solid rgba(45,27,14,0.07)}
.ab-icon{font-size:26px;margin-bottom:9px}
.ab-card h4{font-size:13px;font-weight:700;color:var(--soil);margin-bottom:4px}
.ab-card p{font-size:12px;color:var(--muted);line-height:1.5}
.mission-strip{margin-top:44px;padding-top:36px;border-top:1px solid rgba(45,27,14,0.08);text-align:center}
.mission-strip h3{font-family:'Playfair Display',serif;font-size:22px;color:var(--soil);margin-bottom:12px}
.mission-strip p{color:var(--muted);max-width:580px;margin:0 auto 28px;font-size:14px;line-height:1.75}
.team-row{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
.team-c{text-align:center}
.team-av{width:66px;height:66px;border-radius:50%;margin:0 auto 9px;display:flex;align-items:center;justify-content:center;font-size:26px}
.team-c h4{font-size:13px;font-weight:700;color:var(--soil)}
.team-c p{font-size:11px;color:var(--muted)}

/* ‚ïê‚ïê‚ïê‚ïê SCHEMES ‚ïê‚ïê‚ïê‚ïê */
#schemes{scroll-margin-top:var(--nav-h)}
.filter-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:22px}
.fbtn{padding:7px 15px;border-radius:20px;border:2px solid rgba(45,27,14,0.12);background:transparent;color:var(--muted);cursor:pointer;font-size:13px;font-weight:600;transition:all .2s;font-family:'Source Sans 3',sans-serif}
.fbtn.active,.fbtn:hover{border-color:var(--leaf);background:rgba(61,122,61,0.08);color:var(--leaf)}
.schemes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:18px}
.scheme-c{background:#fff;border-radius:16px;padding:22px;border:1px solid rgba(45,27,14,0.07);border-left:4px solid var(--leaf);box-shadow:0 2px 12px rgba(45,27,14,0.05);transition:all .2s;cursor:pointer}
.scheme-c:hover{transform:translateY(-3px);box-shadow:0 8px 26px rgba(45,27,14,0.1)}
.sch-badge{display:inline-block;padding:3px 9px;border-radius:18px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:11px}
.sch-badge.central{background:rgba(41,128,185,0.12);color:#2471A3}
.sch-badge.state{background:rgba(39,174,96,0.12);color:#1E8449}
.sch-badge.credit{background:rgba(230,126,34,0.12);color:#BA4A00}
.scheme-c h3{font-family:'Playfair Display',serif;font-size:16px;color:var(--soil);margin-bottom:7px}
.scheme-c p{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:12px}
.sch-benefit{display:flex;align-items:center;gap:7px;font-size:13px;font-weight:600;color:var(--leaf)}
.sch-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:10px}
.sch-tag{background:rgba(61,122,61,0.08);color:var(--leaf);font-size:11px;padding:2px 7px;border-radius:5px;font-weight:600}
.sch-link{display:inline-flex;align-items:center;gap:4px;margin-top:12px;font-size:12px;font-weight:700;color:var(--leaf);text-decoration:none}

/* ‚ïê‚ïê‚ïê‚ïê LOADING ‚ïê‚ïê‚ïê‚ïê */
.loading-overlay{position:fixed;inset:0;background:rgba(45,27,14,0.55);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:500}
.loading-overlay.active{display:flex}
.loading-box{background:#fff;border-radius:20px;padding:36px 44px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.2)}
.spin{width:54px;height:54px;border:4px solid rgba(61,122,61,0.15);border-top-color:var(--leaf);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}
.ls-list{list-style:none;text-align:left;margin-top:13px}
.ls-list li{font-size:13px;color:var(--muted);padding:3px 0 3px 20px;position:relative}
.ls-list li::before{content:'‚óã';position:absolute;left:0;color:var(--muted)}
.ls-list li.done::before{content:'‚úì';color:var(--leaf)}
.ls-list li.active::before{content:'‚óâ';color:var(--harvest)}

/* ‚ïê‚ïê‚ïê‚ïê CHATBOT ‚ïê‚ïê‚ïê‚ïê */
.chat-fab{
  position:fixed;bottom:28px;right:28px;z-index:300;
  width:60px;height:60px;border-radius:50%;
  background:linear-gradient(135deg,var(--leaf),#1E4A1E);
  border:none;cursor:pointer;box-shadow:0 6px 22px rgba(61,122,61,0.5);
  display:flex;align-items:center;justify-content:center;font-size:24px;
  transition:all .3s;animation:fabP 3s ease-in-out infinite;
}
@keyframes fabP{0%,100%{box-shadow:0 6px 22px rgba(61,122,61,0.5)}50%{box-shadow:0 6px 34px rgba(61,122,61,0.8)}}
.chat-fab:hover{transform:scale(1.1)}
.fab-label{
  position:fixed;bottom:36px;right:98px;z-index:300;
  background:var(--soil);color:var(--harvest);font-size:12px;font-weight:700;
  padding:5px 11px;border-radius:18px;white-space:nowrap;pointer-events:none;
  box-shadow:0 3px 12px rgba(0,0,0,0.2);
}
.chat-win{
  position:fixed;bottom:98px;right:28px;z-index:300;
  width:355px;height:510px;background:#fff;border-radius:20px;
  box-shadow:0 20px 60px rgba(45,27,14,0.2);display:none;flex-direction:column;
  overflow:hidden;border:1px solid rgba(45,27,14,0.1);
}
.chat-win.open{display:flex;animation:chatO .3s ease}
@keyframes chatO{from{opacity:0;transform:translateY(18px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.chat-hdr{background:linear-gradient(135deg,var(--leaf),#1E4A1E);padding:14px 18px;display:flex;align-items:center;gap:11px}
.chat-av{width:38px;height:38px;border-radius:50%;background:var(--harvest);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.chat-hdr-t h4{font-size:14px;font-weight:700;color:#fff}
.chat-hdr-t p{font-size:11px;color:rgba(255,255,255,0.7)}
.chat-dot{width:8px;height:8px;border-radius:50%;background:#2ECC71;margin-left:auto}
.chat-x{background:rgba(255,255,255,0.15);border:none;color:#fff;width:26px;height:26px;border-radius:50%;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center}
.chat-msgs{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:9px}
.cmsg{max-width:84%}
.cmsg.bot{align-self:flex-start}.cmsg.user{align-self:flex-end}
.cbubble{padding:9px 13px;border-radius:13px;font-size:13px;line-height:1.5}
.cmsg.bot .cbubble{background:var(--cream);color:var(--text);border:1px solid rgba(45,27,14,0.08);border-radius:4px 13px 13px 13px}
.cmsg.user .cbubble{background:var(--leaf);color:#fff;border-radius:13px 4px 13px 13px}
.ctime{font-size:10px;color:var(--muted);margin-top:2px}
.cmsg.user .ctime{text-align:right}
.quick-btns{display:flex;flex-wrap:wrap;gap:5px;padding:8px 14px 0}
.qbtn{padding:5px 10px;border-radius:13px;border:1px solid rgba(61,122,61,0.25);background:rgba(61,122,61,0.06);color:var(--leaf);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Source Sans 3',sans-serif}
.qbtn:hover{background:var(--leaf);color:#fff}
.typing-row{display:none;padding:0 14px 0}
.typing-row.vis{display:flex}
.tbubble{background:var(--cream);border:1px solid rgba(45,27,14,0.08);border-radius:4px 13px 13px 13px;padding:9px 13px;display:flex;gap:4px;align-items:center}
.tdot{width:7px;height:7px;border-radius:50%;background:var(--muted);animation:tb 1.4s infinite}
.tdot:nth-child(2){animation-delay:.2s}.tdot:nth-child(3){animation-delay:.4s}
@keyframes tb{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-7px)}}
.chat-inp-row{padding:10px 14px;border-top:1px solid rgba(45,27,14,0.08);display:flex;gap:7px;align-items:center}
.chat-inp{flex:1;padding:8px 12px;border:2px solid rgba(45,27,14,0.1);border-radius:18px;font-family:'Source Sans 3',sans-serif;font-size:13px;outline:none;transition:border-color .2s;background:var(--cream)}
.chat-inp:focus{border-color:var(--leaf)}
.chat-send{width:34px;height:34px;border-radius:50%;background:var(--leaf);border:none;color:#fff;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.chat-send:hover{background:#2D5A2D;transform:scale(1.05)}

/* ‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê */
footer{background:var(--soil);padding:36px 24px;text-align:center}
.f-logo{font-family:'Playfair Display',serif;font-size:22px;color:var(--harvest);font-weight:900;margin-bottom:8px}
.f-sub{font-size:12px;color:rgba(255,255,255,0.4);margin-bottom:20px}
.f-links{display:flex;justify-content:center;gap:22px;flex-wrap:wrap;margin-bottom:18px}
.f-links a{color:rgba(255,255,255,0.6);font-size:13px;text-decoration:none}
.f-links a:hover{color:var(--harvest)}
.f-copy{font-size:11px;color:rgba(255,255,255,0.3)}

@media(max-width:900px){
  .hero-inner,.about-grid{grid-template-columns:1fr}.feature-cards{display:none}
  .kpi-row,.mod-grid,.reason-grid{grid-template-columns:1fr}
  .chat-win{width:calc(100vw - 28px);right:14px}
  .nav-links{display:none}
  .team-row{grid-template-columns:1fr 1fr}
}
@media(max-width:600px){
  .hero-h1{font-size:34px}.hero-stats,.about-cards{grid-template-columns:1fr 1fr}
  .form-grid{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="nav-brand" onclick="gotoSec('home')">
    <div class="nav-logo">üåæ</div>
    <div>
      <div class="nav-brand-name">KisanMitra</div>
      <div class="nav-brand-sub">Smart Farming Platform</div>
    </div>
  </div>
  <div class="nav-links">
    <button class="nav-link active" onclick="gotoSec('home',this)">üè† Home</button>
    <button class="nav-link" onclick="gotoSec('analyzer',this)">üîç Analyzer</button>
    <button class="nav-link" onclick="gotoSec('about',this)">‚ÑπÔ∏è About</button>
    <button class="nav-link" onclick="gotoSec('schemes',this)">üèõÔ∏è Govt Schemes</button>
  </div>
  <button class="nav-cta" onclick="gotoSec('analyzer',null)">‚ö° Free Analysis</button>
  <div class="nav-lang">
    <button class="lang-btn active" onclick="setLang('en',this)">EN</button>
    <button class="lang-btn" onclick="setLang('hi',this)">‡§π‡§ø</button>
  </div>
</nav>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-box">
    <div class="spin"></div>
    <h3 style="font-family:'Playfair Display',serif;color:var(--soil);margin-bottom:4px">Analyzing your crop‚Ä¶</h3>
    <p style="font-size:13px;color:var(--muted);margin-bottom:12px">Pulling real-time data from multiple sources</p>
    <ul class="ls-list" id="lsList">
      <li class="active" id="ls1">Fetching weather forecast (7-day)</li>
      <li id="ls2">Reading soil health indicators</li>
      <li id="ls3">Scanning mandi price history (90-day)</li>
      <li id="ls4">Calculating optimal harvest window</li>
      <li id="ls5">Assessing spoilage risk & storage</li>
      <li id="ls6">Ranking best markets by net profit</li>
    </ul>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê -->
<section id="home" style="scroll-margin-top:var(--nav-h)">
  <div class="hero-band">
    <div class="hero-inner">
      <div>
        <h1 class="hero-h1">Smart Farming,<br><span>Better Earnings</span><br>for Every Kisan</h1>
        <p class="hero-p">India's AI-powered farm-to-market platform. Know exactly <strong>when to harvest</strong>, <strong>where to sell</strong>, and <strong>how to store</strong> ‚Äî in plain language, in your language.</p>
        <div class="hero-btns">
          <button class="btn-primary" onclick="gotoSec('analyzer',null)">‚ö° Get Free Analysis</button>
          <button class="btn-outline" onclick="gotoSec('schemes',null)">üèõÔ∏è View Govt Schemes</button>
        </div>
        <div class="hero-stats">
          <div class="stat-box"><div class="stat-num">500+</div><div class="stat-lbl">Mandi Prices Tracked</div></div>
          <div class="stat-box"><div class="stat-num">40%</div><div class="stat-lbl">Avg Waste Reduction</div></div>
          <div class="stat-box"><div class="stat-num">9</div><div class="stat-lbl">Crops Supported</div></div>
        </div>
        <div class="hero-pills">
          <div class="hero-pill">üå°Ô∏è Live Weather</div>
          <div class="hero-pill">üìà Real Mandi Data</div>
          <div class="hero-pill">‚úÖ Explainable AI</div>
          <div class="hero-pill">üó£Ô∏è Hindi Support</div>
        </div>
      </div>
      <div class="feature-cards">
        <div class="feat-card"><div class="feat-icon">üåæ</div><div><h4>Harvest Window Advisor</h4><p>Weather + soil data combined to find your perfect 4-day harvest window.</p></div></div>
        <div class="feat-card"><div class="feat-icon">üè™</div><div><h4>Best Mandi Finder</h4><p>Net profit after transport ‚Äî not just the highest price. Real data from 500+ markets.</p></div></div>
        <div class="feat-card"><div class="feat-icon">üì¶</div><div><h4>Spoilage Risk Guard</h4><p>Post-harvest spoilage predicted. Preservation actions ranked by cost-effectiveness.</p></div></div>
        <div class="feat-card"><div class="feat-icon">ü§ñ</div><div><h4>Annadata AI Chat</h4><p>Ask farming questions in Hindi or English. Your personal advisor, 24√ó7.</p></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê ANALYZER ‚ïê‚ïê‚ïê‚ïê -->
<section id="analyzer">
  <div class="sec-wrap">
    <div class="sec-title">üîç Crop Intelligence Analyzer</div>
    <div class="sec-sub">Enter your crop details ‚Äî get harvest timing, best market, spoilage risk & preservation advice in seconds</div>

    <div class="input-card">
      <div class="card-title"><span>üå±</span> Tell us about your crop</div>
      <div class="card-sub">All fields are used to give you the most accurate, personalised recommendation</div>
      <div class="form-grid">
        <div class="form-group">
          <label>Crop Type</label>
          <select id="cropType">
            <option value="tomato">üçÖ Tomato (‡§ü‡§Æ‡§æ‡§ü‡§∞)</option>
            <option value="wheat">üåæ Wheat (‡§ó‡•á‡§π‡•Ç‡§Ç)</option>
            <option value="rice">üçö Rice (‡§ö‡§æ‡§µ‡§≤)</option>
            <option value="onion">üßÖ Onion (‡§™‡•ç‡§Ø‡§æ‡§ú)</option>
            <option value="potato">ü•î Potato (‡§Ü‡§≤‡•Ç)</option>
            <option value="soybean">ü´ò Soybean (‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®)</option>
            <option value="cotton">üå∏ Cotton (‡§ï‡§™‡§æ‡§∏)</option>
            <option value="maize">üåΩ Maize (‡§Æ‡§ï‡•ç‡§ï‡§æ)</option>
          </select>
        </div>
        <div class="form-group">
          <label>State</label>
          <select id="state">
            <option value="maharashtra">Maharashtra</option>
            <option value="punjab">Punjab</option>
            <option value="uttar_pradesh">Uttar Pradesh</option>
            <option value="madhya_pradesh">Madhya Pradesh</option>
            <option value="rajasthan">Rajasthan</option>
            <option value="karnataka">Karnataka</option>
            <option value="gujarat">Gujarat</option>
            <option value="haryana">Haryana</option>
            <option value="andhra_pradesh">Andhra Pradesh</option>
            <option value="telangana">Telangana</option>
          </select>
        </div>
        <div class="form-group">
          <label>District / Mandi Area</label>
          <select id="district">
            <option value="nashik">Nashik</option>
            <option value="pune">Pune</option>
            <option value="nagpur">Nagpur</option>
            <option value="amravati">Amravati</option>
            <option value="kolhapur">Kolhapur</option>
            <option value="aurangabad">Aurangabad</option>
            <option value="indore">Indore</option>
            <option value="bhopal">Bhopal</option>
          </select>
        </div>
        <div class="form-group">
          <label>Harvest Stage</label>
          <select id="harvestStage">
            <option value="15days">Ready in ~15 days</option>
            <option value="7days">Ready in ~7 days</option>
            <option value="ready">Ready now</option>
            <option value="overdue">Slightly overdue</option>
          </select>
        </div>
        <div class="form-group">
          <label>Storage Available</label>
          <select id="storage">
            <option value="none">No cold storage</option>
            <option value="warehouse">Warehouse (dry)</option>
            <option value="cold">Cold storage</option>
            <option value="home">Home storage</option>
          </select>
        </div>
        <div class="form-group">
          <label>Land Size (acres)</label>
          <input type="number" id="landSize" value="2.5" min="0.5" step="0.5">
        </div>
      </div>
      <button class="analyze-btn" onclick="runAnalysis()">‚ö° Get My Recommendations ‚Äî Free</button>
    </div>

    <!-- RESULTS -->
    <div class="results-section" id="resultsSection">
      <div class="kpi-row">
        <div class="kpi-card g"><div class="kpi-lbl">Best Harvest Window</div><div class="kpi-val" id="harvestDateVal">‚Äî</div><div class="kpi-desc" id="harvestDaysVal">‚Äî</div></div>
        <div class="kpi-card o"><div class="kpi-lbl">Spoilage Risk</div><div class="kpi-val" id="spoilageVal">‚Äî</div><div class="kpi-desc" id="spoilageDescVal">‚Äî</div></div>
        <div class="kpi-card b"><div class="kpi-lbl">Expected Net Profit</div><div class="kpi-val" id="profitVal">‚Äî</div><div class="kpi-desc" id="profitDescVal">‚Äî</div></div>
      </div>
      <div class="mod-grid">
        <!-- Harvest -->
        <div class="mod-card">
          <div class="mod-hdr"><div class="mod-icon g">üåæ</div><div class="mod-hdr-t"><h3>Optimal Harvest Window</h3><p>Based on weather + crop maturity</p></div></div>
          <div style="padding:8px 0">
            <div class="timeline-track"><div class="timeline-fill" style="left:38%;width:26%"></div><div class="timeline-marker" style="left:51%"></div></div>
            <div class="tl-labels"><span>Today</span><span id="tl2">+5d</span><span id="tl3" style="color:var(--harvest);font-weight:700">Best ‚≠ê</span><span id="tl4">+20d</span></div>
          </div>
          <div class="harvest-rec"><div class="rec-main" id="harvestRec">‚Äî</div><div class="rec-sub" id="harvestRecSub">‚Äî</div></div>
          <div class="flist" id="harvestFactors"></div>
        </div>
        <!-- Markets -->
        <div class="mod-card">
          <div class="mod-hdr"><div class="mod-icon b">üè™</div><div class="mod-hdr-t"><h3>Best Market to Sell</h3><p>Price vs transport cost analysis</p></div></div>
          <table class="mkt-tbl"><thead><tr><th>Mandi</th><th>Price/kg</th><th>Transport</th><th>Net Profit</th></tr></thead><tbody id="mktBody"></tbody></table>
          <div id="trendAlert" style="margin-top:10px"></div>
        </div>
        <!-- Spoilage -->
        <div class="mod-card">
          <div class="mod-hdr"><div class="mod-icon o">‚ö†Ô∏è</div><div class="mod-hdr-t"><h3>Post-Harvest Spoilage Risk</h3><p>Storage + transit analysis</p></div></div>
          <div class="gauge-wrap">
            <div class="gauge-c">
              <svg viewBox="0 0 84 84" width="84" height="84">
                <circle cx="42" cy="42" r="34" fill="none" stroke="rgba(45,27,14,0.08)" stroke-width="7"/>
                <circle id="gaugeArc" cx="42" cy="42" r="34" fill="none" stroke="#E67E22" stroke-width="7" stroke-dasharray="213.6" stroke-dashoffset="141" stroke-linecap="round"/>
              </svg>
              <span class="gauge-n" id="gaugeN" style="color:#E67E22">‚Äî</span>
              <span class="gauge-p">risk</span>
            </div>
            <div class="gauge-t"><h4 id="gaugeL" style="color:#E67E22">‚Äî</h4><p id="gaugeD">‚Äî</p></div>
          </div>
          <div class="flist" id="spoilageFacts"></div>
        </div>
        <!-- Actions -->
        <div class="mod-card">
          <div class="mod-hdr"><div class="mod-icon r">üõ°Ô∏è</div><div class="mod-hdr-t"><h3>Preservation Actions</h3><p>Ranked by cost-effectiveness</p></div></div>
          <div class="act-list" id="actList"></div>
        </div>
      </div>
      <!-- WHY PANEL -->
      <div class="why-card">
        <div style="display:flex;align-items:center;gap:9px;margin-bottom:3px">
          <span style="font-size:19px">ü§î</span>
          <span style="font-family:'Playfair Display',serif;font-size:19px;color:var(--harvest);font-weight:700">Why did we recommend this?</span>
        </div>
        <div style="color:rgba(255,255,255,0.5);font-size:12px;margin-bottom:2px">Every recommendation comes with a full explanation ‚Äî because trust matters as much as accuracy</div>
        <div class="reason-grid" id="reasonGrid"></div>
        <div class="conf-banner">
          <span style="font-size:19px">üéØ</span>
          <div class="conf-t"><h4 id="confTitle">‚Äî</h4><p id="confBasis">‚Äî</p></div>
          <div style="margin-left:auto;flex-shrink:0;text-align:right">
            <div class="conf-bar-o"><div class="conf-bar-i" id="confBar" style="width:0%"></div></div>
            <div class="conf-pct" id="confPct">‚Äî</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê ABOUT ‚ïê‚ïê‚ïê‚ïê -->
<section id="about">
  <div class="sec-wrap">
    <div class="sec-title">‚ÑπÔ∏è About KisanMitra</div>
    <div class="sec-sub">Built to solve India's farm-to-market intelligence gap</div>
    <div class="about-grid">
      <div class="about-txt">
        <h3>The Problem We're Solving</h3>
        <p>India's farmers lose up to <strong>40% of produce</strong> not because of poor farming ‚Äî but poor timing and market mismatch. A farmer in Nashik may harvest tomatoes the same day 200 others do, crashing mandi prices.</p>
        <p>KisanMitra combines real weather data, soil health indicators, and live mandi price history to recommend the <strong>optimal harvest window</strong> and <strong>best target market</strong> for every crop and region.</p>
        <p>Every recommendation is explained in plain language ‚Äî because a farmer must <em>trust</em> advice before acting on it, especially when their livelihood is at stake.</p>
      </div>
      <div class="about-cards">
        <div class="ab-card"><div class="ab-icon">üå¶Ô∏è</div><h4>Weather Intelligence</h4><p>7-day IMD-based forecasts integrated into every harvest recommendation.</p></div>
        <div class="ab-card"><div class="ab-icon">üìä</div><h4>Real Mandi Data</h4><p>AGMARKNET price data from 500+ mandis across India, updated daily.</p></div>
        <div class="ab-card"><div class="ab-icon">üß™</div><h4>Soil Health Aware</h4><p>Crop maturity windows calibrated with soil moisture and nutrient data.</p></div>
        <div class="ab-card"><div class="ab-icon">üó£Ô∏è</div><h4>Built for Farmers</h4><p>Plain language, Hindi support ‚Äî works on a basic Android phone.</p></div>
      </div>
    </div>
    <div class="mission-strip">
      <h3>Our Mission</h3>
      <p>Technology should work <em>for</em> the farmer, not the other way around. We design every feature asking: <em>"Can a farmer with a basic Android phone understand and trust this?"</em></p>
      <div class="team-row">
        <div class="team-c"><div class="team-av" style="background:rgba(61,122,61,0.1)">üë®‚Äçüíª</div><h4>AI/ML Team</h4><p>Harvest & price models</p></div>
        <div class="team-c"><div class="team-av" style="background:rgba(41,128,185,0.1)">üìä</div><h4>Data Team</h4><p>Mandi & weather pipelines</p></div>
        <div class="team-c"><div class="team-av" style="background:rgba(230,126,34,0.1)">üé®</div><h4>Design Team</h4><p>Farmer-first UX</p></div>
        <div class="team-c"><div class="team-av" style="background:rgba(192,57,43,0.1)">üåæ</div><h4>Agri Advisors</h4><p>Domain validation</p></div>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê GOVT SCHEMES ‚ïê‚ïê‚ïê‚ïê -->
<section id="schemes">
  <div class="sec-wrap">
    <div class="sec-title">üèõÔ∏è Government Farmer Schemes</div>
    <div class="sec-sub">Central & state schemes you may be eligible for ‚Äî updated 2024‚Äì25</div>
    <div class="filter-row">
      <button class="fbtn active" onclick="filterS('all',this)">All Schemes</button>
      <button class="fbtn" onclick="filterS('central',this)">üèõÔ∏è Central Govt</button>
      <button class="fbtn" onclick="filterS('state',this)">üó∫Ô∏è State Govt</button>
      <button class="fbtn" onclick="filterS('credit',this)">üí≥ Credit & Insurance</button>
    </div>
    <div class="schemes-grid" id="schemesGrid"></div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div style="max-width:1180px;margin:0 auto">
    <div class="f-logo">üåæ KisanMitra</div>
    <div class="f-sub">Smart Farming Platform ‚Äî Farm-to-Market Intelligence</div>
    <div class="f-links">
      <a href="#" onclick="gotoSec('home',null)">Home</a>
      <a href="#" onclick="gotoSec('analyzer',null)">Analyzer</a>
      <a href="#" onclick="gotoSec('about',null)">About</a>
      <a href="#" onclick="gotoSec('schemes',null)">Schemes</a>
      <a href="https://enam.gov.in" target="_blank">e-NAM</a>
      <a href="https://pmkisan.gov.in" target="_blank">PM-KISAN</a>
    </div>
    <div class="f-copy">¬© 2025 KisanMitra. Built with ‚ù§Ô∏è for Indian Farmers. | Data: AGMARKNET, IMD | Backend: AgriChain API</div>
  </div>
</footer>

<!-- ‚ïê‚ïê‚ïê‚ïê ANNADATA AI CHATBOT ‚ïê‚ïê‚ïê‚ïê -->
<div class="fab-label">Annadata AI üåæ</div>
<button class="chat-fab" onclick="toggleChat()" title="Ask Annadata AI">ü§ñ</button>
<div class="chat-win" id="chatWin">
  <div class="chat-hdr">
    <div class="chat-av">ü§ñ</div>
    <div class="chat-hdr-t"><h4>Annadata AI</h4><p>Your personal crop advisor</p></div>
    <div class="chat-dot"></div>
    <button class="chat-x" onclick="toggleChat()">‚úï</button>
  </div>
  <div class="chat-msgs" id="chatMsgs">
    <div class="cmsg bot">
      <div class="cbubble">üôè Namaste! I'm <strong>Annadata AI</strong> ‚Äî your personal farming assistant.<br><br>Ask me anything about crops, mandi prices, weather timing, or government schemes. Hindi or English ‚Äî both work! üåæ</div>
      <div class="ctime">Now</div>
    </div>
  </div>
  <div class="quick-btns" id="quickBtns">
    <button class="qbtn" onclick="quickAsk('Best time to sell tomatoes?')">üçÖ Tomato prices</button>
    <button class="qbtn" onclick="quickAsk('PM Kisan scheme details')">üèõÔ∏è PM Kisan</button>
    <button class="qbtn" onclick="quickAsk('How to reduce crop spoilage?')">üì¶ Spoilage tips</button>
    <button class="qbtn" onclick="quickAsk('When should I harvest wheat?')">üåæ Wheat harvest</button>
  </div>
  <div class="typing-row" id="typingRow">
    <div class="tbubble"><div class="tdot"></div><div class="tdot"></div><div class="tdot"></div></div>
  </div>
  <div class="chat-inp-row">
    <input class="chat-inp" id="chatInp" placeholder="Ask Annadata AI anything‚Ä¶" onkeydown="if(event.key==='Enter')sendChat()">
    <button class="chat-send" onclick="sendChat()">‚û§</button>
  </div>
</div>

<script>
// ‚îÄ‚îÄ Config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const API_BASE = window.API_BASE || 'http://localhost:8000';

// ‚îÄ‚îÄ Nav ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function gotoSec(id, btn) {
  document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'start'});
  if(btn){ document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active')); btn.classList.add('active'); }
}
function setLang(lang,btn){
  document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active');
  if(lang==='hi') addMsg('bot','‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§≠‡•Ä ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§\n\n‡§´‡§∏‡§≤, ‡§Æ‡§Ç‡§°‡•Ä ‡§≠‡§æ‡§µ, ‡§ï‡§ü‡§æ‡§à ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Æ‡§Ø, ‡§Ø‡§æ ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç ‚Äî ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§™‡•Ç‡§õ‡•á‡§Ç! üåæ');
}

// ‚îÄ‚îÄ Schemes data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SCHEMES=[
  {t:'central',n:'PM-KISAN',d:'Direct income support of ‚Çπ6,000/year to eligible farmer families in three equal installments of ‚Çπ2,000 each.',b:'‚Çπ6,000/year per family',tags:['All Farmers','Direct Benefit'],link:'https://pmkisan.gov.in'},
  {t:'credit', n:'Pradhan Mantri Fasal Bima Yojana (PMFBY)',d:'Crop insurance providing financial support for crop loss due to natural calamities, pests & diseases. Low premiums for farmers.',b:'Up to full sum insured on crop loss',tags:['Kharif','Rabi','Commercial'],link:'https://pmfby.gov.in'},
  {t:'credit', n:'Kisan Credit Card (KCC)',d:'Timely access to credit for agricultural needs at 4% effective interest rate. Includes personal accident cover of ‚Çπ50,000.',b:'Up to ‚Çπ3 lakh @ 4% interest',tags:['Credit','Insurance','Flexible'],link:'#'},
  {t:'central',n:'Paramparagat Krishi Vikas Yojana (PKVY)',d:'Promotes organic farming through cluster approach. Financial assistance for inputs, certification, and marketing over 3 years.',b:'‚Çπ50,000/hectare over 3 years',tags:['Organic','Cluster','Certification'],link:'#'},
  {t:'central',n:'Sub-Mission on Agricultural Mechanisation (SMAM)',d:'Subsidy on agricultural machinery. Up to 50% subsidy for small and marginal farmers on purchase of tractors, harvesters, and implements.',b:'Up to 50% machinery subsidy',tags:['Equipment','Machinery','Tractor'],link:'#'},
  {t:'central',n:'Soil Health Card Scheme',d:'Free soil testing for every farmer. Provides crop-wise recommendations for fertilizers and micronutrients to improve productivity.',b:'Free soil testing + nutrient card',tags:['Soil','Free','Nutrition'],link:'https://soilhealth.dac.gov.in'},
  {t:'state',  n:'State Disaster Relief Fund (SDRF)',d:'Compensation for crop loss from natural disasters ‚Äî drought, flood, hailstorm, pest attack. Rates vary by state and crop.',b:'‚Çπ8,500‚Äì13,500/hectare compensation',tags:['Disaster','Natural Calamity','Compensation'],link:'#'},
  {t:'central',n:'e-NAM (National Agriculture Market)',d:'Online trading platform connecting farmers to buyers across India. Better price discovery, reduced middlemen, transparent transactions.',b:'Direct access to 1,000+ mandis',tags:['Market','Digital','Price Discovery'],link:'https://enam.gov.in'},
  {t:'central',n:'mKisan Portal',d:'SMS-based advisory service for real-time crop advisory, pest/disease alerts, and market prices direct to farmers\' phones.',b:'Free SMS crop advisories',tags:['Mobile','Advisory','Free'],link:'https://mkisan.gov.in'},
];
function renderSchemes(f='all'){
  const g=document.getElementById('schemesGrid');
  const arr=f==='all'?SCHEMES:SCHEMES.filter(s=>s.t===f);
  g.innerHTML=arr.map(s=>`
    <div class="scheme-c" data-type="${s.t}">
      <div class="sch-badge ${s.t}">${s.t==='central'?'üèõÔ∏è Central Govt':s.t==='state'?'üó∫Ô∏è State Govt':'üí≥ Credit & Insurance'}</div>
      <h3>${s.n}</h3><p>${s.d}</p>
      <div class="sch-benefit">‚úÖ ${s.b}</div>
      <div class="sch-tags">${s.tags.map(t=>`<span class="sch-tag">${t}</span>`).join('')}</div>
      <a class="sch-link" href="${s.link}" target="_blank">Learn more & Apply ‚Üí</a>
    </div>`).join('');
}
function filterS(t,btn){document.querySelectorAll('.fbtn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderSchemes(t);}
renderSchemes();

// ‚îÄ‚îÄ Loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startLoading(cb){
  const ov=document.getElementById('loadingOverlay');ov.classList.add('active');
  const steps=['ls1','ls2','ls3','ls4','ls5','ls6'];
  steps.forEach(s=>{const e=document.getElementById(s);e.classList.remove('active','done');});
  document.getElementById('ls1').classList.add('active');
  let i=0;
  function tick(){
    if(i>0){document.getElementById(steps[i-1]).classList.remove('active');document.getElementById(steps[i-1]).classList.add('done');}
    if(i<steps.length){document.getElementById(steps[i]).classList.add('active');i++;setTimeout(tick,440+Math.random()*300);}
    else{setTimeout(()=>{ov.classList.remove('active');if(cb)cb();},280);}
  }
  tick();
}

// ‚îÄ‚îÄ Run analysis ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function runAnalysis(){
  const p={
    crop_type:    document.getElementById('cropType').value,
    state:        document.getElementById('state').value,
    district:     document.getElementById('district').value,
    harvest_stage:document.getElementById('harvestStage').value,
    storage_type: document.getElementById('storage').value,
    land_size:    parseFloat(document.getElementById('landSize').value)||2.5,
  };
  let d=null,err=null;
  const fp=fetch(`${API_BASE}/analyze`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)})
    .then(r=>{if(!r.ok)return r.json().then(e=>{throw new Error(e.detail||'API error '+r.status)});return r.json();})
    .then(x=>{d=x}).catch(e=>{err=e});
  startLoading(async()=>{
    await fp;
    if(err){
      document.getElementById('loadingOverlay').classList.remove('active');
      alert('‚ö†Ô∏è Could not get recommendations:\n'+err.message+'\n\nStart the API server first:\n  uvicorn main:app --reload --port 8000\n\nThen refresh this page.');
    } else renderResults(d);
  });
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResults(d){
  // KPIs
  document.getElementById('harvestDateVal').textContent=d.harvest_date_val;
  document.getElementById('harvestDaysVal').textContent=d.harvest_days_val;
  document.getElementById('spoilageVal').textContent=d.spoilage_val;
  document.getElementById('spoilageDescVal').textContent=d.spoilage_desc_val;
  document.getElementById('profitVal').textContent=d.profit_val;
  document.getElementById('profitDescVal').textContent=d.profit_desc_val;
  // Harvest
  document.getElementById('harvestRec').textContent=d.harvest_window.recommendation;
  document.getElementById('harvestRecSub').textContent=d.harvest_window.recommendation_sub;
  document.getElementById('harvestFactors').innerHTML=(d.harvest_window.factors||[]).map(f=>
    `<div class="fi ${f.type}"><div class="fdot"></div><span>${f.text}</span></div>`).join('');
  // Markets
  document.getElementById('mktBody').innerHTML=d.markets.map(m=>`
    <tr ${m.is_best?'class="br"':''}><td><strong>${m.name}</strong>${m.is_best?'<span class="best-badge">Best</span>':''}</td>
    <td style="font-weight:700;color:var(--leaf)">${m.price_display}</td><td>${m.transport_display}</td>
    <td><div class="pbar-wrap"><div class="pbar" style="width:${m.bar_width}px;background:${m.profit_color}"></div>
    <span style="font-weight:700;font-size:11px;color:${m.profit_color}">${m.net_profit_display}</span></div></td></tr>`).join('');
  const bm=d.markets[0];
  document.getElementById('trendAlert').innerHTML=`<div style="padding:10px;background:rgba(41,128,185,0.06);border-radius:9px;border:1px solid rgba(41,128,185,0.15)"><div style="font-size:11px;font-weight:700;color:#2980B9;margin-bottom:2px">üìä Price Trend</div><div style="font-size:12px;color:var(--muted)">${bm.name}: ${bm.trend}. Sell within 2‚Äì3 days of harvest.</div></div>`;
  // Gauge
  const sr=d.spoilage_risk;
  const rc=sr.risk_color.replace('var(--warn)','#E67E22').replace('var(--rust)','#C0392B').replace('var(--success)','#27AE60');
  // Recalculate dashoffset for r=34 circle: circumference = 2œÄ√ó34 ‚âà 213.6
  const circ=213.6; const offset=circ*(1-sr.risk_pct/100);
  document.getElementById('gaugeArc').setAttribute('stroke',rc);
  document.getElementById('gaugeArc').setAttribute('stroke-dashoffset',offset.toFixed(1));
  document.getElementById('gaugeN').textContent=sr.risk_pct+'%'; document.getElementById('gaugeN').style.color=rc;
  document.getElementById('gaugeL').textContent=sr.risk_level+' Risk'; document.getElementById('gaugeL').style.color=rc;
  document.getElementById('gaugeD').textContent=sr.description;
  document.getElementById('spoilageFacts').innerHTML=(sr.factors||[]).map(f=>`<div class="fi ${f.type}"><div class="fdot"></div><span>${f.text}</span></div>`).join('');
  // Actions
  document.getElementById('actList').innerHTML=(d.preservation_actions||[]).map(a=>{
    const ds=Array.from({length:5},(_,i)=>`<div class="dot${i<a.effectiveness?' f':''}"></div>`).join('');
    return `<div class="act-item"><div class="act-rank ${a.rank_class}">${a.rank}</div><div class="act-body"><div class="act-name">${a.title}</div><div class="act-detail">${a.detail}</div></div><div style="text-align:right"><div class="act-cost">${a.cost_display}</div><div class="dots" style="justify-content:flex-end;margin-top:3px">${ds}</div></div></div>`;
  }).join('');
  // Why
  document.getElementById('reasonGrid').innerHTML=(d.reasoning_steps||[]).map(s=>
    `<div class="reason-step"><div class="rs-num">${s.step_num}</div><div class="rs-title">${s.icon} ${s.title}</div><div class="rs-desc">${s.desc}</div></div>`).join('');
  document.getElementById('confTitle').textContent=`Prediction Confidence: ${d.confidence.score}%`;
  document.getElementById('confBasis').textContent=d.confidence.basis;
  document.getElementById('confBar').style.width=d.confidence.score+'%';
  document.getElementById('confPct').textContent=d.confidence.label;
  // Show
  const res=document.getElementById('resultsSection');
  res.classList.add('visible');
  res.scrollIntoView({behavior:'smooth',block:'start'});
}

// ‚ïê‚ïê‚ïê‚ïê ANNADATA AI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const KB={
  tomato: 'Tomato prices: ‚Çπ20‚Äì35/kg at major mandis. Nashik APMC is Asia\'s largest tomato market.\nHarvest when 70‚Äì80% fruits turn red. Early morning (5‚Äì8 AM) harvesting reduces field heat damage.',
  wheat: 'Wheat MSP 2024‚Äì25: ‚Çπ2,275/quintal. Market rates: ‚Çπ2,100‚Äì2,400/quintal.\nHarvest when grain moisture drops below 14%. Golden-yellow colour = maturity indicator.',
  onion: 'Onion prices are volatile (‚Çπ8‚Äì40/kg seasonally). Lasalgaon APMC is India\'s largest onion market.\nHarvest when 50% tops fall naturally. Field cure 7‚Äì10 days before storage.',
  potato: 'Potato: ‚Çπ10‚Äì18/kg. Agra & Aligarh are major markets. Cold storage extends selling by 6‚Äì8 months.\nHarvest 10 days after vine dies. Cure at 15‚Äì20¬∞C for 2 weeks.',
  rice: 'Rice MSP 2024‚Äì25: ‚Çπ2,300/quintal (Common), ‚Çπ2,320 (Grade A).\nHarvest when 80‚Äì85% grains turn golden. Dry to 14% moisture for storage.',
  pmkisan: 'PM-KISAN provides ‚Çπ6,000/year in 3 installments of ‚Çπ2,000 each.\n‚úÖ Eligibility: All farmer families with cultivable land\n‚ùå Excluded: Govt employees, income tax payers\nüìç Apply: pmkisan.gov.in or nearest CSC center',
  kcc: 'Kisan Credit Card provides crop loans up to ‚Çπ3 lakh at 4% effective interest (7% with 3% govt subsidy).\n‚úÖ Apply at any bank/cooperative with land records\n‚úÖ Includes accident insurance of ‚Çπ50,000',
  fasal: 'PMFBY crop insurance: Premium is 2% for Kharif, 1.5% for Rabi, 5% for commercial crops.\nClaim if actual yield falls below threshold yield. Apply via bank or insurance company.',
  spoilage: 'Top 3 ways to reduce spoilage:\nü•á Harvest early morning (5‚Äì8 AM) ‚Äî FREE, reduces field heat\nü•à Use ventilated crates not gunny bags ‚Äî ‚Çπ800‚Äì1,200\nü•â Pre-cool at cold storage before long transit ‚Äî ‚Çπ2,500‚Äì3,000\n\nThis can cut spoilage from 35% ‚Üí ~12%.',
  mandi: 'To get best mandi prices:\n1. Check e-NAM portal (enam.gov.in) for live prices\n2. Sell 2‚Äì3 days after harvest while fresh\n3. Grade and sort produce before selling\n4. Sell in morning when buyers are most active\n5. Consider FPO (Farmer Producer Organisation) for better bargaining power',
  soil: 'Get a free Soil Health Card via Soil Health Card Scheme.\nApply at local KVK (Krishi Vigyan Kendra) or Agriculture Department.\nCard shows N, P, K, pH, micronutrients + crop-wise fertilizer recommendations.',
  def: [
    'Great question! Use the KisanMitra Crop Analyzer above for personalised recommendations ‚Äî it uses real weather data and mandi prices for your specific crop and district. üåæ',
    'For the most accurate advice, please use the Crop Analyzer above. You can also call Kisan Call Centre at 1800-180-1551 (toll-free, 22 languages). üìû',
    'I recommend checking e-NAM (enam.gov.in) for live mandi prices and PM-KISAN portal for government scheme eligibility. The KisanMitra Analyzer gives free personalised recommendations! üåæ'
  ]
};
let di=0;
function getReply(m){
  const l=m.toLowerCase();
  if(l.includes('tomato'))return 'üçÖ **Tomato Info:**\n\n'+KB.tomato;
  if(l.includes('wheat'))return 'üåæ **Wheat Info:**\n\n'+KB.wheat;
  if(l.includes('onion')||l.includes('‡§™‡•ç‡§Ø‡§æ‡§ú'))return 'üßÖ **Onion Info:**\n\n'+KB.onion;
  if(l.includes('potato')||l.includes('‡§Ü‡§≤‡•Ç'))return 'ü•î **Potato Info:**\n\n'+KB.potato;
  if(l.includes('rice')||l.includes('paddy'))return 'üçö **Rice Info:**\n\n'+KB.rice;
  if(l.includes('pm kisan')||l.includes('pmkisan'))return 'üèõÔ∏è **PM-KISAN:**\n\n'+KB.pmkisan;
  if(l.includes('kcc')||l.includes('kisan credit'))return 'üí≥ **Kisan Credit Card:**\n\n'+KB.kcc;
  if(l.includes('fasal bima')||l.includes('insurance'))return 'üõ°Ô∏è **Fasal Bima Yojana:**\n\n'+KB.fasal;
  if(l.includes('spoilage')||l.includes('storage')||l.includes('preserve'))return 'üì¶ **Reduce Spoilage:**\n\n'+KB.spoilage;
  if(l.includes('mandi')||l.includes('sell')||l.includes('market')||l.includes('price'))return 'üè™ **Mandi & Selling Tips:**\n\n'+KB.mandi;
  if(l.includes('soil'))return 'üß™ **Soil Health:**\n\n'+KB.soil;
  if(l.includes('hello')||l.includes('hi')||l.includes('‡§®‡§Æ‡§∏‡•ç‡§§‡•á'))return 'üôè Namaste! I\'m Annadata AI.\n\nAsk me about crops, mandi prices, government schemes, or when to harvest. Hindi or English ‚Äî both work! üåæ';
  return KB.def[di++%KB.def.length];
}
function toggleChat(){document.getElementById('chatWin').classList.toggle('open')}
function addMsg(role,text){
  const c=document.getElementById('chatMsgs');
  const t=new Date().toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});
  const d=document.createElement('div');d.className='cmsg '+role;
  d.innerHTML=`<div class="cbubble">${text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')}</div><div class="ctime">${t}</div>`;
  c.appendChild(d);c.scrollTop=c.scrollHeight;
}
async function sendChat(){
  const inp=document.getElementById('chatInp');
  const msg=inp.value.trim();if(!msg)return;
  inp.value='';document.getElementById('quickBtns').style.display='none';
  addMsg('user',msg);
  const tr=document.getElementById('typingRow');tr.classList.add('vis');
  document.getElementById('chatMsgs').scrollTop=9999;
  await new Promise(r=>setTimeout(r,850+Math.random()*550));
  tr.classList.remove('vis');
  addMsg('bot',getReply(msg));
}
function quickAsk(q){document.getElementById('chatInp').value=q;sendChat();}
</script>
</body>
</html>
